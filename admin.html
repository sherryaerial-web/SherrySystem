<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Sherry Aerial è«‹å‡ç³»çµ±</title>
  <style>
    body { font-family: -apple-system, sans-serif; background: #f8f9fa; padding: 15px; color: #333; }
    .card { background: #fff; padding: 20px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 20px; }
    h2 { color: #455a64; margin-top: 0; font-size: 1.2rem; border-left: 5px solid #455a64; padding-left: 10px; }
    select, button { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: 1px solid #ddd; font-size: 16px; }
    button.submit-btn { background: #455a64; color: white; border: none; font-weight: bold; cursor: pointer; }
    .course-item { display: flex; align-items: center; padding: 12px 0; border-bottom: 1px solid #eee; }
    .course-item input { margin-right: 15px; transform: scale(1.3); }
    .status-tag { padding: 4px 8px; border-radius: 6px; font-size: 12px; font-weight: bold; }
  </style>
</head>
<body>
  <div class="card">
    <h2>ğŸ‘‹ è€å¸«è«‹å‡ç™»è¨˜</h2>
    <select id="teacherSelect"><option value="">è®€å–åå–®ä¸­...</option></select>
    <div id="courseList">è®€å–èª²ç¨‹ä¸­...</div>
    <button class="submit-btn" onclick="submitLeave()">æäº¤è«‹å‡ç”³è«‹</button>
  </div>
  <div class="card">
    <h2>ğŸ“… ä»£èª²é€²åº¦çœ‹æ¿</h2>
    <div id="board">è®€å–ä¸­...</div>
  </div>
  <script>
    const APP_URL = "https://script.google.com/macros/s/AKfycbyJADHe_DZdNIbfv_KPewAcBekEond-5Fw63i-RWCd1mHl_O9uGAQ-LTnzENZshjnhe/exec"; 
    window.onload = () => {
      fetch(`${APP_URL}?action=getTeachers`).then(r => r.json()).then(data => {
        const select = document.getElementById('teacherSelect');
        select.innerHTML = '<option value="">è«‹é¸æ“‡æ‚¨çš„åå­—</option>' + 
          data.map(t => `<option value="${t['æŒ‡å°è€…']}">${t['æŒ‡å°è€…']}</option>`).join('');
      });
      fetch(`${APP_URL}?action=getCourse`).then(r => r.json()).then(data => {
        document.getElementById('courseList').innerHTML = data.map(c => `
          <div class="course-item">
            <input type="checkbox" class="chk" value='${JSON.stringify(c)}'>
            <div><strong>${new Date(c['æ—¥æœŸ']).toLocaleDateString('zh-TW')}</strong><br>
            <small>${c['æ™‚é–“']} ${c['èª²ç¨‹']}</small></div>
          </div>`).join('');
      });
      renderBoard();
    };
    function renderBoard() {
      fetch(`${APP_URL}?action=getCourse&isAdmin=true`).then(r => r.json()).then(data => {
        const items = data.filter(d => d['æŒ‡å°è€…'] !== "æŒ‡å°è€…").slice(-15).reverse();
        document.getElementById('board').innerHTML = items.map(l => `
          <div style="display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px solid #eee; align-items:center;">
            <div><strong>${new Date(l['æ—¥æœŸ']).toLocaleDateString('zh-TW')} ${l['èª²ç¨‹']}</strong><br><small>${l['æŒ‡å°è€…']} è€å¸«</small></div>
            <span class="status-tag" style="background:${l['ä»£èª²è€å¸«']?'#e8f5e9':'#fff3e0'}; color:${l['ä»£èª²è€å¸«']?'#2e7d32':'#ef6c00'};">
              ${l['ä»£èª²è€å¸«'] ? 'âœ… å·²çµæ¡ˆ' : (l['ç‹€æ…‹'] === 'è©¢å•ä¸­' ? 'â³ æ´½è©¢ä¸­' : 'â“ å¾µæ±‚ä¸­')}
            </span>
          </div>`).join('');
      });
    }
    function submitLeave() {
      const name = document.getElementById('teacherSelect').value;
      const selected = Array.from(document.querySelectorAll('.chk:checked')).map(el => JSON.parse(el.value));
      if (!name || selected.length === 0) return alert("è«‹é¸æ“‡åå­—èˆ‡èª²ç¨‹");
      fetch(`${APP_URL}?instructor=${name}&items=${encodeURIComponent(JSON.stringify(selected))}`)
        .then(() => { alert("ç”³è«‹æˆåŠŸï¼å·²æ”¾å…¥çœ‹æ¿"); location.reload(); });
    }
  </script>
</body>
</html>
