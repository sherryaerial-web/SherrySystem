<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ä»£èª²é ˜å–ç«¯</title>
  <style>
    body { font-family: sans-serif; background: #f4f7f6; padding: 15px; }
    .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
    .item { border: 1px solid #eee; padding: 15px; border-radius: 10px; margin-top: 15px; }
    .btn { width: 100%; background: #27ae60; color: white; border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px; }
  </style>
</head>
<body>
  <div class="card">
    <h2>ğŸ™‹ å¾…é ˜å–ä»£èª²æ¸…å–®</h2>
    <div id="list">è®€å–ä¸­...</div>
  </div>

  <script>
    const APP_URL = "https://script.google.com/macros/s/AKfycbyJADHe_DZdNIbfv_KPewAcBekEond-5Fw63i-RWCd1mHl_O9uGAQ-LTnzENZshjnhe/exec";

    function load() {
      const container = document.getElementById('list');
      fetch(`${APP_URL}?action=getCourse&isAdmin=true`)
        .then(r => r.json())
        .then(data => {
          const available = data.filter(c => c['ç‹€æ…‹'] === 'ç¢ºèªä¸­' && (!c['ä»£èª²è€å¸«'] || c['ä»£èª²è€å¸«'] === ""));
          if (available.length === 0) { container.innerHTML = "ç›®å‰æš«ç„¡ç©ºç¼ºèª²ç¨‹ã€‚"; return; }
          container.innerHTML = available.map(item => `
            <div class="item">
              <strong>${item['æŒ‡å°è€…']} è€å¸«</strong><br>
              èª²ç¨‹ï¼š${item['èª²ç¨‹']}<br>
              æ™‚é–“ï¼š${item['æ—¥æœŸ']} (${item['æ™‚é–“']})<br>
              <div style="color:orange;">ğŸ“¢ å„ªå…ˆè©¢å•ï¼š${item['æœ€å¾Œè©¢å•å°è±¡'] || 'ç­‰å€™ä¸­'}</div>
              <button class="btn" onclick="take('${item.rowId}')">ç¢ºèªé ˜å–ä»£èª²</button>
            </div>
          `).join('');
        });
    }

    function take(id) {
      const name = prompt("è«‹è¼¸å…¥æ‚¨çš„åå­—ï¼š");
      if(!name) return;
      fetch(`${APP_URL}?action=takeCourse&rowId=${id}&subName=${encodeURIComponent(name)}`)
        .then(r => r.text())
        .then(msg => { alert(msg); load(); });
    }
    window.onload = load;
  </script>
</body>
</html>
