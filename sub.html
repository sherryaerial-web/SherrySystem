<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Sherry Aerial ä»£èª²é ˜å–ç³»çµ±</title>
  <style>
    :root { --success: #27ae60; --primary: #34495e; --bg: #f4f7f6; }
    body { font-family: -apple-system, sans-serif; background: var(--bg); padding: 15px; }
    .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; }
    h2 { color: var(--primary); border-left: 4px solid var(--primary); padding-left: 10px; margin-bottom: 20px; }
    .course-box { border: 1px solid #eee; border-radius: 12px; padding: 15px; margin-bottom: 15px; background: #fff; }
    .info strong { font-size: 1.1rem; color: #2c3e50; }
    .ask-info { color: #d35400; font-weight: bold; background: #fff3e0; padding: 5px 10px; border-radius: 6px; display: inline-block; margin: 10px 0; font-size: 0.9rem; }
    .take-btn { width: 100%; background: var(--success); color: white; border: none; padding: 14px; border-radius: 10px; font-size: 1rem; font-weight: bold; cursor: pointer; }
    .time-badge { background: #e8f4fd; color: #2980b9; padding: 2px 8px; border-radius: 4px; font-weight: 600; }
  </style>
</head>
<body>

<div class="card">
  <h2>ğŸ™‹ å¾…é ˜å–èª²è¡¨</h2>
  <div id="subList">è®€å–ä¸­...</div>
</div>

<script>
  // è«‹æ›´æ›ç‚ºå¦³æœ€æ–°çš„ GAS Web App ç¶²å€
  const APP_URL = "https://script.google.com/macros/s/AKfycbyJADHe_DZdNIbfv_KPewAcBekEond-5Fw63i-RWCd1mHl_O9uGAQ-LTnzENZshjnhe/exec"; 

  function formatSafeTime(t) {
    if (!t) return "--:--";
    let s = String(t);
    if (s.includes("T") || s.includes("1899")) {
        let d = new Date(t);
        return d.getHours().toString().padStart(2, '0') + ":" + d.getMinutes().toString().padStart(2, '0');
    }
    return s;
  }

  window.onload = () => {
    fetch(`${APP_URL}?action=getCourse&isAdmin=true`)
      .then(r => r.json())
      .then(data => {
        // åŒæ™‚æª¢æŸ¥ã€Œå¾µæ±‚ä¸­ã€æˆ–ã€Œç¢ºèªä¸­ã€ï¼Œä¸” G æ¬„æ˜¯ç©ºçš„æ‰é¡¯ç¤º
        const list = data.filter(c => (c['ç‹€æ…‹'] === 'ç¢ºèªä¸­' || c['ç‹€æ…‹'] === 'å¾µæ±‚ä¸­') && (!c['ä»£èª²è€å¸«'] || c['ä»£èª²è€å¸«'] === ""));
        const container = document.getElementById('subList');
        
        if(list.length === 0) {
          container.innerHTML = "ç›®å‰æš«ç„¡ç©ºç¼ºèª²ç¨‹ã€‚";
          return;
        }

        container.innerHTML = list.map(item => `
          <div class="course-box">
            <div class="info">
              <strong>${item['æŒ‡å°è€…']} è€å¸«</strong><br>
              èª²ç¨‹ï¼š${item['èª²ç¨‹']}<br>
              æ—¥æœŸï¼š${item['æ—¥æœŸ'].split('T')[0]} <span class="time-badge">${formatSafeTime(item['æ™‚é–“'])}</span><br>
              <div class="ask-info">ğŸ“¢ ç›®å‰å„ªå…ˆè©¢å•ï¼š${item['æœ€å¾Œè©¢å•å°è±¡'] || 'ç­‰å¾…æ’éšŠä¸­'}</div>
            </div>
            <button class="take-btn" onclick="takeCourse('${item.rowId}', '${item['èª²ç¨‹']}')">æˆ‘å·²ç¢ºèªä»£èª²</button>
          </div>
        `).join('');
      });
  };

  function takeCourse(id, name) {
    const subName = prompt(`ç¢ºèªç”±æ‚¨é ˜å–ã€${name}ã€‘é€™å ‚ä»£èª²å—ï¼Ÿ\nè«‹è¼¸å…¥æ‚¨çš„åå­—ï¼š`);
    if(!subName) return;
    fetch(`${APP_URL}?action=takeCourse&rowId=${id}&subName=${encodeURIComponent(subName)}`)
      .then(r => r.text())
      .then(msg => {
        alert(msg);
        location.reload();
      });
  }
</script>
</body>
</html>
